<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BadaBoomBooks Web Interface - Integrated</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap Icons -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
    <!-- Custom CSS -->
    <link href="{{ url_for('static', filename='css/style.css') }}" rel="stylesheet">
    <!-- Modal fixes CSS -->
    <link href="{{ url_for('static', filename='css/modal-fixes.css') }}" rel="stylesheet">
</head>
<body>
    <div class="container-fluid">
        <div class="row">
            <!-- Sidebar -->
            <nav class="col-md-3 col-lg-2 d-md-block sidebar collapse">
                <div class="position-sticky pt-3">
                    <h5 class="sidebar-heading d-flex justify-content-between align-items-center px-3 mt-4 mb-1 text-muted">
                        <span>üéß BadaBoomBooks</span>
                        <small class="badge bg-success">Integrated</small>
                    </h5>
                    
                    <ul class="nav flex-column">
                        <li class="nav-item">
                            <a class="nav-link active" href="#dashboard" onclick="showSection('dashboard')">
                                <i class="bi bi-house-door"></i> Dashboard
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#browser" onclick="showSection('browser')">
                                <i class="bi bi-folder"></i> Browse Files
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#options" onclick="showSection('options')">
                                <i class="bi bi-gear"></i> Processing Options
                            </a>
                        </li>
                    </ul>
                    
                    <div class="mt-4 px-3">
                        <h6 class="sidebar-heading">Selected Folders</h6>
                        <div class="badge bg-secondary mb-2">
                            <span id="selected-count">0</span> selected
                        </div>
                        <div id="selected-folders"></div>
                        
                        <div class="mt-3">
                            <button id="process-btn" class="btn btn-success w-100 mb-2" onclick="startProcessing()" disabled>
                                <i class="bi bi-play-circle"></i> Start Processing
                            </button>
                            <button id="preview-btn" class="btn btn-outline-primary w-100" onclick="previewChanges()" disabled>
                                <i class="bi bi-eye"></i> Preview Changes
                            </button>
                        </div>
                        
                        <div class="mt-3">
                            <h6 class="sidebar-heading">Processing Summary</h6>
                            <div id="processing-summary" class="small text-muted">
                                <div class="text-muted small">Configure options to see processing plan</div>
                            </div>
                        </div>
                    </div>
                </div>
            </nav>
            
            <!-- Main content -->
            <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
                <!-- Dashboard Section -->
                <div id="dashboard" class="content-section">
                    <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                        <h1 class="h2">üìö BadaBoomBooks Web Interface</h1>
                        <div class="badge bg-success text-white">Real Processing Integration</div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-8">
                            <div class="alert alert-success">
                                <h5 class="alert-heading">üî• Real BadaBoomBooks Integration!</h5>
                                <p>This version integrates directly with the BadaBoomBooks application core:</p>
                                <ul>
                                    <li>üìÅ <strong>Browse Files</strong> - Select audiobook folders to organize</li>
                                    <li>‚öôÔ∏è <strong>Configure Options</strong> - Full control over processing features</li>
                                    <li>üîÑ <strong>Real Processing</strong> - Actual metadata scraping and file operations</li>
                                    <li>üìä <strong>Live Progress</strong> - Real-time updates during processing</li>
                                    <li>üõ°Ô∏è <strong>Dry Run Mode</strong> - Test processing without making changes</li>
                                </ul>
                                <hr>
                                <p class="mb-0">Start by browsing your files and selecting audiobook folders!</p>
                            </div>
                            
                            <div class="row mt-4">
                                <div class="col-md-6">
                                    <div class="card">
                                        <div class="card-body text-center">
                                            <h5 class="card-title">üéß Real Processing</h5>
                                            <p class="card-text small">Process audiobooks with actual metadata scraping from Audible, Goodreads, and LubimyCzytac</p>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="card">
                                        <div class="card-body text-center">
                                            <h5 class="card-title">üõ°Ô∏è Safe Testing</h5>
                                            <p class="card-text small">Use dry run mode to see exactly what would happen before making any file changes</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="card">
                                <div class="card-header">
                                    <h6 class="card-title mb-0">Quick Start</h6>
                                </div>
                                <div class="card-body">
                                    <ol class="small">
                                        <li>Go to <strong>Browse Files</strong></li>
                                        <li>Select audiobook folders (üéß)</li>
                                        <li>Configure <strong>Processing Options</strong></li>
                                        <li>Enable "Dry Run" for testing</li>
                                        <li>Click <strong>Start Processing</strong></li>
                                    </ol>
                                </div>
                            </div>
                            
                            <div class="card mt-3">
                                <div class="card-header">
                                    <h6 class="card-title mb-0">Status</h6>
                                </div>
                                <div class="card-body">
                                    <div id="integration-status" class="small">
                                        <div class="text-muted">Testing integration...</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Browse Files Section -->
                <div id="browser" class="content-section" style="display: none;">
                    <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                        <h1 class="h2">üìÅ Browse Files</h1>
                        <div class="btn-group" role="group">
                            <button class="btn btn-outline-secondary btn-sm" onclick="showDrives()" title="Show drives">
                                <i class="bi bi-hdd"></i> Drives
                            </button>
                            <button class="btn btn-outline-secondary btn-sm" onclick="goUp()" title="Go up one level">
                                <i class="bi bi-arrow-up"></i> Up
                            </button>
                            <button class="btn btn-outline-primary btn-sm" onclick="refreshBrowser()" title="Refresh current directory">
                                <i class="bi bi-arrow-clockwise"></i> Refresh
                            </button>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-lg-8">
                            <div class="card">
                                <div class="card-header">
                                    <div class="d-flex justify-content-between align-items-center">
                                        <div class="d-flex align-items-center flex-grow-1">
                                            <span class="me-2">üìç Path:</span>
                                            <input type="text" class="form-control form-control-sm me-2" 
                                                   id="path-input" placeholder="Enter path manually..." 
                                                   onkeypress="handlePathInput(event)">
                                            <span id="current-path" class="text-muted small">/</span>
                                        </div>
                                    </div>
                                </div>
                                <div class="card-body p-0">
                                    <div id="file-list" class="list-group list-group-flush" style="max-height: 500px; overflow-y: auto;">
                                        <div class="list-group-item text-center text-muted py-4">
                                            <i class="bi bi-folder display-4"></i>
                                            <p class="mt-2 mb-0">Loading directories...</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-lg-4">
                            <div class="card">
                                <div class="card-header">
                                    <h6 class="card-title mb-0">Selection Info</h6>
                                </div>
                                <div class="card-body">
                                    <p class="small text-muted mb-2">Click on audiobook folders (üéß) to select them for processing.</p>
                                    <div class="mb-3">
                                        <span class="badge bg-primary">Selected: <span id="selected-count-display">0</span></span>
                                    </div>
                                    <div id="selected-folders-display" style="max-height: 300px; overflow-y: auto;"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Processing Options Section -->
                <div id="options" class="content-section" style="display: none;">
                    <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                        <h1 class="h2">‚öôÔ∏è Processing Options</h1>
                    </div>
                    
                    <form id="processing-form">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="card">
                                    <div class="card-header">
                                        <h6 class="card-title mb-0">üîç Search & Metadata</h6>
                                    </div>
                                    <div class="card-body">
                                        <div class="form-check mb-3">
                                            <input class="form-check-input" type="checkbox" id="auto-search" checked>
                                            <label class="form-check-label" for="auto-search">
                                                <strong>Auto Search</strong><br>
                                                <small class="text-muted">Automatically search for metadata instead of manual selection</small>
                                            </label>
                                        </div>
                                        
                                        <div class="mb-3">
                                            <label for="search-site" class="form-label">Search Sites</label>
                                            <select class="form-select" id="search-site">
                                                <option value="all">All Sites (Recommended)</option>
                                                <option value="audible">Audible Only</option>
                                                <option value="goodreads">Goodreads Only</option>
                                                <option value="lubimyczytac">LubimyCzytac Only</option>
                                            </select>
                                        </div>
                                        
                                        <div class="form-check mb-3">
                                            <input class="form-check-input" type="checkbox" id="opf" checked>
                                            <label class="form-check-label" for="opf">
                                                <strong>Generate OPF files</strong><br>
                                                <small class="text-muted">Create metadata.opf files for ebook readers</small>
                                            </label>
                                        </div>
                                        
                                        <div class="form-check mb-3">
                                            <input class="form-check-input" type="checkbox" id="id3-tags">
                                            <label class="form-check-label" for="id3-tags">
                                                <strong>Update ID3 tags</strong><br>
                                                <small class="text-muted">Update audio file metadata tags</small>
                                            </label>
                                        </div>
                                        
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" id="cover">
                                            <label class="form-check-label" for="cover">
                                                <strong>Download cover images</strong><br>
                                                <small class="text-muted">Download and save book cover images</small>
                                            </label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="col-md-6">
                                <div class="card">
                                    <div class="card-header">
                                        <h6 class="card-title mb-0">üìÅ File Organization</h6>
                                    </div>
                                    <div class="card-body">
                                        <div class="form-check mb-3">
                                            <input class="form-check-input" type="checkbox" id="series-org">
                                            <label class="form-check-label" for="series-org">
                                                <strong>Series Organization</strong><br>
                                                <small class="text-muted">Organize books by series when detected</small>
                                            </label>
                                        </div>
                                        
                                        <div class="form-check mb-3">
                                            <input class="form-check-input" type="checkbox" id="flatten">
                                            <label class="form-check-label" for="flatten">
                                                <strong>Flatten folder structure</strong><br>
                                                <small class="text-muted">Move all files to root of book folder</small>
                                            </label>
                                        </div>
                                        
                                        <div class="form-check mb-3">
                                            <input class="form-check-input" type="checkbox" id="rename">
                                            <label class="form-check-label" for="rename">
                                                <strong>Rename audio files</strong><br>
                                                <small class="text-muted">Use consistent naming for audio tracks</small>
                                            </label>
                                        </div>
                                        
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" id="info-txt">
                                            <label class="form-check-label" for="info-txt">
                                                <strong>Generate info.txt files</strong><br>
                                                <small class="text-muted">Create human-readable metadata files</small>
                                            </label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="row mt-4">
                            <div class="col-md-6">
                                <div class="card">
                                    <div class="card-header">
                                        <h6 class="card-title mb-0">üõ°Ô∏è Safety Options</h6>
                                    </div>
                                    <div class="card-body">
                                        <div class="form-check mb-3">
                                            <input class="form-check-input" type="checkbox" id="dry-run" checked>
                                            <label class="form-check-label" for="dry-run">
                                                <strong>Dry Run Mode</strong><br>
                                                <small class="text-muted">Preview changes without modifying any files</small>
                                            </label>
                                        </div>
                                        
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" id="debug-mode">
                                            <label class="form-check-label" for="debug-mode">
                                                <strong>Debug Mode</strong><br>
                                                <small class="text-muted">Show detailed processing information</small>
                                            </label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="col-md-6">
                                <div class="card">
                                    <div class="card-header">
                                        <h6 class="card-title mb-0">‚ö° Advanced Settings</h6>
                                    </div>
                                    <div class="card-body">
                                        <div class="mb-3">
                                            <label for="search-limit" class="form-label">Search Results Limit</label>
                                            <input type="number" class="form-control" id="search-limit" value="5" min="1" max="20">
                                            <div class="form-text">Maximum search results to consider</div>
                                        </div>
                                        
                                        <div class="mb-3">
                                            <label for="search-delay" class="form-label">Search Delay (seconds)</label>
                                            <input type="number" class="form-control" id="search-delay" value="2.0" min="0" max="10" step="0.5">
                                            <div class="form-text">Delay between searches to be respectful</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
            </main>
        </div>
    </div>
    
    <!-- Progress Modal -->
    <div class="modal fade" id="progressModal" tabindex="-1" data-bs-backdrop="static" data-bs-keyboard="false">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">üîÑ Processing Audiobooks</h5>
                    <span id="status-badge" class="badge bg-secondary ms-2">STARTING</span>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-4">
                            <h6>Progress Overview</h6>
                            <div class="progress mb-3">
                                <div id="progress-bar" class="progress-bar progress-bar-striped progress-bar-animated" 
                                     role="progressbar" style="width: 0%" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
                            </div>
                            
                            <div class="mb-2">
                                <strong>Status:</strong> 
                                <span id="progress-text">Initializing...</span>
                            </div>
                            <div class="mb-2">
                                <strong>Progress:</strong> 
                                <span id="progress-percentage">0%</span>
                            </div>
                            <div class="mb-2">
                                <strong>Current Book:</strong> 
                                <span id="current-book-name">-</span>
                            </div>
                            <div class="mb-2">
                                <strong>Elapsed:</strong> 
                                <span id="elapsed-time">0:00</span>
                            </div>
                        </div>
                        <div class="col-md-8">
                            <div class="d-flex justify-content-between align-items-center mb-2">
                                <h6>Processing Log</h6>
                                <button id="download-log-btn" class="btn btn-sm btn-outline-secondary" onclick="downloadLog()" style="display: none;">
                                    <i class="bi bi-download"></i> Download Log
                                </button>
                            </div>
                            <div id="processing-log" class="border rounded p-3" 
                                 style="height: 350px; overflow-y: auto; font-family: 'Courier New', monospace; font-size: 0.875rem; background-color: #f8f9fa;">
                                <div class="text-muted">Waiting for processing to start...</div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button id="cancel-job-btn" type="button" class="btn btn-secondary" onclick="cancelJob()">
                        <i class="bi bi-x-circle"></i> Cancel Processing
                    </button>
                    <button id="close-progress-btn" type="button" class="btn btn-primary" onclick="closeProgressModal()" style="display: none;">
                        <i class="bi bi-check-circle"></i> Close
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Integrated App JS -->
    <script src="{{ url_for('static', filename='js/app_integrated.js') }}"></script>
</body>
</html>